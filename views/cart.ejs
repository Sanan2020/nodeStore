<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome Icons CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .tb-cart {
            background: #ffffff;
            box-shadow: 2px 2px 10px rgba(12, 12, 12, 0.4);
        }

        th {
            text-align: center;
            padding-top: 15px;
            border-bottom: 6px solid #5e5d5d;
        }

        td {
            border-bottom: 6px solid #5e5d5d;
        }

        .tdimg {
            width: 25%;
        }

        .c-img {
            width: 100%;
            height: 100%;
        }

        .tdname {
            width: 36%;
        }

        .td-qt {
            width: 100%;
            display: flex;
            justify-content: center;
            /* background: #000; */
        }

        .qt {
            width: 100%;
            font-size: 11px;
            text-align: center;
        }

        .tdtotal {
            width: 12%;
            text-align: center;
        }

        .tdrm {
            width: 10%;
        }

        .btn-rm {
            font-size: 100%;
            color: rgb(247, 243, 243);
            border: 0;
            text-indent: 0;
            font-family: FontAwesome;
        }

        /* เริ่มจาก1200 */
        @media (min-width: 1200px) {
            .custom-mt {
                margin-top: 6.3rem;
            }
        }

        .btn-command {
            width: 80%;
            display: flex;
            justify-content: space-between;

            border-radius: 20px;
            background: red;
            border: none;
            align-items: center;
        }

        .btn-command:hover {
            background: #f77676;
        }

        .des {
            margin: 10px;
            color: #f3f2f2;
        }

        .con {
            padding: 10px;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(12, 12, 12, 0.4);
        }

        /* สิ้นสุด 991*/
        @media (max-width: 991px) {
            th {
                display: none;
            }

            .hide {
                display: none;
            }

            .con {
                font-size: 18px;
            }

            .btn-command {
                height: 40px;
            }
        }

        /* สิ้นสุด 767*/
        @media (max-width: 767px) {
            .btn-command {
                height: 35px;
            }

            .con {
                font-size: 14px;
            }

            .tb-cart {
                font-size: 10px;
            }

            th {
                display: none;
            }

            .hide {
                display: none;
            }
        }
    </style>
</head>

<body>
    <script src="/cart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
            $(document).ready(function() {
            // ดึงข้อมูลจาก localStorage
            let cartLocal = JSON.parse(localStorage.getItem('cartLocal')) || [];
            // ถ้า cartLocal มีข้อมูลสินค้า
            if (cartLocal.length > 0) {
                // สร้าง HTML ที่จะใช้แสดงสินค้าทั้งหมด
                let cartHTML = '';
                cartLocal.forEach(function(item) {
                    cartHTML += `
   
                        <tr>
                        <td class="tdimg"><img src="/image/ney.jpg" class="c-img"></td>

                        <td class="tdname">
                            <div>แป้งครอฟเฟิลสำเร็จรูป (แช่แข็ง) SYNOVA : แป้งครอฟเฟิลทรงขาตรงสำเร็จรูป
                                (ขนาดเล็ก) (ยกกล่อง)</div>
                        </td>
                        <td id="price1" class="hide">฿${item.price}</td>

                        <td>
                            <div class="td-qt"><input type="number" id="quantity-1" class="form-control qt" value="${item.count}" min="1" max="10" onclick="count();"></div>
                        </td>

                        <td class="tdtotal" id="total-price1">฿${item.price * item.count}</td>

                        <td class="tdrm"><a class="btn btn-danger btn-rm" onclick="alert('dd');">X</a></td>
                    </tr>
                    `;
                });

                // ใช้ .html() เพื่อแสดงผลทั้งหมดใน container
                $('#cartItems').html(cartHTML);
            } else {
                // ถ้าไม่มีสินค้าในตะกร้า
                $('#cartItems').html("Your cart is empty.");
            }
        });
                     
    </script>

    <!-- Shopping Cart Section -->
    <div class="container">
        <div class="row row-cols-1 row-cols-md-1 row-cols-lg-1 row-cols-xl-2">

            <div class="col-xl-8 mt-5">
                <h4>ตระกร้าของฉัน</h4>
                <table class="tb-cart mt-4">

                    <tr>
                        <th colspan="2">สินค้า</th>
                        <th>ราคา</th>
                        <th>จำนวน</th>
                        <th>รวม</th>
                        <th></th>
                    </tr>

                    <!-- -ตัวอย่างข้อมูล -->
                    
                    <tr>
                        <div id="cartItems"></div>
                    </tr>
                  
                    <tr>
                        <td class="tdimg"><img src="/image/ney.jpg" class="c-img"></td>

                        <td class="tdname">
                            <div>แป้งครอฟเฟิลสำเร็จรูป (แช่แข็ง) SYNOVA : แป้งครอฟเฟิลทรงขาตรงสำเร็จรูป
                                (ขนาดเล็ก) (ยกกล่อง)</div>
                        </td>
                        <td id="price1" class="hide">฿99.99</td>

                        <td>
                            <div class="td-qt"><input type="number" id="quantity-1" class="form-control qt" value="1"
                                    min="1" max="10" onclick="count();"></div>
                        </td>

                        <td class="tdtotal" id="total-price1">฿99.99</td>

                        <td class="tdrm"><a class="btn btn-danger btn-rm" onclick="alert('dd');">X</a></td>
                    </tr>

                    <tr>
                        <td class="tdimg"><img src="image/ney.jpg" class="c-img"></td>

                        <td class="tdname">
                            <div>แป้งครอฟเฟิลสำเร็จรูป (แช่แข็ง) SYNOVA : แป้งครอฟเฟิลทรงขาตรงสำเร็จรูป
                                (ขนาดเล็ก) (ยกกล่อง)</div>
                        </td>
                        <td id="price1" class="hide">฿99.99</td>

                        <td>
                            <div class="td-qt"><input type="number" id="quantity-1" class="form-control qt" value="1"
                                    min="1" max="10" onclick="count();"></div>
                        </td>

                        <td class="tdtotal" id="total-price1">฿99.99</td>

                        <td class="tdrm"><a class="btn btn-danger btn-rm" onclick="alert('dd');">X</a></td>
                    </tr>
                </table><br><br>

                <script>
                    function count() {
                        var productPrice1 = document.getElementById("price1").textContent;
                        var cleanedPrice = productPrice1.replace(/[^\d.-]/g, ''); // กำจัดตัวอักษรที่ไม่ใช่ตัวเลขหรือจุด
                        var priceAsDecimal = parseFloat(cleanedPrice);
                        // alert(priceAsDecimal);

                        var quantity = document.getElementById("quantity-1").value;
                        var total = priceAsDecimal * quantity;
                        // alert(total);
                        document.getElementById("total-price1").textContent = "$" + total.toFixed(2);
                    }
                </script>

            </div>

            <div class="col-xl-4 custom-mt">
                <div class="con">
                    <div>
                        <h4>3 รายการ</h4>
                    </div>

                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <p>ยอดรวม</p>
                        </div>
                        <div>
                            <p>฿487.00</p>
                        </div>
                    </div>
                    <hr>
                    <p>ยอดรวมทั้งหมด</p>
                    <div style="display: flex; justify-content: center;">
                        <a class="btn-command" style="text-decoration: none; cursor: pointer;">
                            <div class="des">ชำระเงิน</div>
                            <div class="des">฿487.00</div>
                        </a>
                    </div>
                    <p></p>
                </div>
            </div>

        </div>
    </div>

    <!------------------------------------------------------------ รอแก้ไข -------------------------------------------------------------->
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Dummy cart item management logic
        let productPrice = 99.99; // Static price for this example

        // Remove item function
        function removeItem(itemId) {
            var item = document.getElementById(itemId);
            item.remove();
            updateTotal();
        }

        // Update item quantity and recalculate total price
        function updateQuantity(itemId) {
            var quantity = document.getElementById("quantity-" + itemId.split('-')[2]).value;
            var total = productPrice * quantity;
            updateTotal();
        }

        // Update total price, shipping, discount, and final total
        function updateTotal() {
            // Get quantity from the cart item
            var quantity = document.getElementById("quantity-1").value;
            var productTotal = productPrice * quantity;

            // Get shipping cost
            var shippingCost = parseFloat(document.getElementById("shipping-method").value);

            // Apply discount if any
            var discount = parseFloat(document.getElementById("discount-code").value) || 0;
            var discountedTotal = productTotal - discount;

            // Calculate final total
            var finalTotal = discountedTotal + shippingCost;

            // Update the UI with totals
            document.getElementById("total-price").textContent = "$" + productTotal.toFixed(2);
            document.getElementById("discounted-price").textContent = "$" + discountedTotal.toFixed(2);
            document.getElementById("shipping-cost").textContent = "$" + shippingCost.toFixed(2);
            document.getElementById("final-total").textContent = "$" + finalTotal.toFixed(2);
        }

        // Apply discount code (for simplicity, discount code is just a number)
        function applyDiscount() {
            var discountCode = document.getElementById("discount-code").value;
            if (discountCode) {
                // Assume the discount code gives a discount of entered value
                updateTotal();
            }
        }
    </script>
    <!------------------------------------------------------------ รอแก้ไข -------------------------------------------------------------->

</body>

</html>